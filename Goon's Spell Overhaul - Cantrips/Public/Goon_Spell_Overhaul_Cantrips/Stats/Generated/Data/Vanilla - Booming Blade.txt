// ==================================== Booming Blade ====================================
// Bug Fix: Added missing Thunder "DamageType". 
// Changes: Deals additional damage at level 17+ per RAW.
// Changes: No longer interacts with Extra Attack.
// Changes: Now has a somatic component.
// Changes: Targetting unrestricted.

new entry "Target_BoomingBlade_ClassSpell"
type "SpellData"
data "SpellType" "Target"
// using "Target_BoomingBlade"
using "Target_BoomingBlade_ClassSpell"
// data "SpellProperties" "GROUND:DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType);GROUND:ExecuteWeaponFunctors(MainHand);CastOffhand[GROUND:DealDamage(OffhandMeleeWeapon, OffhandMeleeWeaponDamageType);GROUND:ExecuteWeaponFunctors(OffHand)];IF(not Player(context.Source)):ApplyStatus(SELF,AI_HELPER_EXTRAATTACK,100,1);ApplyStatus(SELF,BOOMINGBLADE_BLOCK,100,1);"
data "SpellProperties" "GROUND:DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType);GROUND:ExecuteWeaponFunctors(MainHand);CastOffhand[GROUND:DealDamage(OffhandMeleeWeapon, OffhandMeleeWeaponDamageType);GROUND:ExecuteWeaponFunctors(OffHand)];ApplyStatus(SELF,BOOMINGBLADE_BLOCK,100,1)"
// data "RequirementConditions" "CanUseWeaponActions() and IsProficientWithEquippedWeapon() and not  HasStatus('BOOMINGBLADE_BLOCK');"
// data "RequirementEvents" "OnSourceStatusApplied;OnStatusRemoved"
data "RequirementEvents" "OnEquip;OnUnequip;OnSourceStatusApplied;OnStatusRemoved"
// data "SpellSuccess" "IF(not CharacterLevelGreaterThan(4)):ApplyStatus(BOOMING_BLADE,100,1);IF(CharacterLevelGreaterThan(4) and not CharacterLevelGreaterThan(10)):ApplyStatus(BOOMING_BLADE_5,100,1);IF(CharacterLevelGreaterThan(10)):ApplyStatus(BOOMING_BLADE_11,100,1);IF(CharacterLevelGreaterThan(4)):DealDamage(LevelMapValue(BoomingBlade),Thunder);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType);ExecuteWeaponFunctors(MainHand);ApplyStatus(BOOMINGBLADE_BLOCK,100,1);"
// data "SpellSuccess" "IF(not CharacterLevelGreaterThan(4)):ApplyStatus(BOOMING_BLADE,100,1);IF(CharacterLevelGreaterThan(4) and not CharacterLevelGreaterThan(10)):ApplyStatus(BOOMING_BLADE_5,100,1);IF(CharacterLevelGreaterThan(10)):ApplyStatus(BOOMING_BLADE_11,100,1);IF(CharacterLevelGreaterThan(4)):DealDamage(LevelMapValue(BoomingBlade),Thunder,,,0,,true,true);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType);ExecuteWeaponFunctors(MainHand);ApplyStatus(BOOMINGBLADE_BLOCK,100,1);"
data "SpellSuccess" "IF(CharacterLevelGreaterThan(4)):DealDamage(LevelMapValue(Goon_BladeCantrips),Thunder,,,0,,true,true);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType);ExecuteWeaponFunctors(MainHand);ApplyStatus(BOOMINGBLADE_BLOCK,100,1);IF(not CharacterLevelGreaterThan(4)):ApplyStatus(BOOMING_BLADE,100,1);IF(CharacterLevelGreaterThan(4) and not CharacterLevelGreaterThan(10)):ApplyStatus(BOOMING_BLADE_5,100,1);IF(CharacterLevelGreaterThan(10) and not CharacterLevelGreaterThan(16)):ApplyStatus(BOOMING_BLADE_11,100,1);IF(CharacterLevelGreaterThan(16)):ApplyStatus(GOON_BOOMING_BLADE_17,100,1)"
// data "Icon" "Spell_Evocation_BoomingBlade"
// data "DescriptionParams" "DealDamage(LevelMapValue(D8Cantrip),Thunder);"
data "DescriptionParams" "DealDamage(LevelMapValue(Goon_BladeCantrips),Thunder)"
// data "TooltipDamageList" "DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType);DealDamage(LevelMapValue(BoomingBlade),Thunder)"
data "TooltipDamageList" "DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType);DealDamage(LevelMapValue(Goon_BladeCantrips),Thunder)"
data "DamageType" "Thunder"

new entry "Target_BoomingBlade"
type "SpellData"
data "SpellType" "Target"
// using "Target_Slash_New"
using "Target_BoomingBlade"
// data "SpellSchool" "Evocation"
// data "Cooldown" ""
data "RequirementEvents" "OnEquip;OnUnequip;OnSourceStatusApplied;OnStatusRemoved"
data "SpellRoll" "Goon_BladeCantripAttack()"
// data "SpellSuccess" "ApplyStatus(BOOMING_BLADE,100,1);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType); ExecuteWeaponFunctors(MainHand)"
// data "TargetConditions" "(Character() or Item()) and not Self() and not Dead()"
data "TargetConditions" "not Self() and (Item() or Character() or Dead())"
// data "Icon" "unknown"
// Booming Blade
// data "DisplayName" "h78c417cag2696g4c50gaca1gfd7e81feefb3;2"
// Strike with your weapon, afflicting your foe with a resonance that hurts them for [1] when they move.
// data "Description" "h9f5e7b5agb7c5g4952gb88cg713ff1d09bbb;4"
// data "DescriptionParams" "DealDamage(1d8, Thunder)"
// data "ExtraDescription" ""
// data "TooltipAttackSave" "MeleeWeaponAttack"
// data "TooltipStatusApply" "ApplyStatus(BOOMING_BLADE,100,1)"
// data "PrepareSound" "Spell_Prepare_Sorcerer_BoomingBlade"
// data "PrepareLoopSound" "Spell_Loop_Sorcerer_BoomingBlade_Start"
// data "TargetSound" "Spell_Impact_Damage_Thunder_ThunderousSmite_L1to3"
// data "SpellFlags" "IsMelee;IsHarmful;IsDefaultWeaponAction;IsSpell"
data "SpellFlags" "IsMelee;IsHarmful;IsDefaultWeaponAction;IsSpell;HasSomaticComponent"
// data "PrepareEffect" "da2ac9fb-af83-4650-acfe-514a425c3a2e"
// data "TargetEffect" "288e0f80-7d7c-4f36-b748-17182318180e"
data "DamageType" "Thunder"

// new entry "BOOMING_BLADE"
// type "StatusData"
// data "StatusType" "BOOST"
// using "MAG_THUNDER_REVERBERATION"
// Booming Blade
// data "DisplayName" "hbb17ba78gabf4g43b4g8f0bg2a2a1189842a;1"
// Affected entity will take [1] when it moves.
// data "Description" "hf92f9b1egc1a6g4339gb8b4g9f1ce11e5d67;1"
// data "DescriptionParams" "DealDamage(1d8, Thunder)"
// data "StackId" "BOOMING_BLADE"
// data "StackType" ""
// data "TickType" "EndTurn"
// data "Boosts" ""
// data "Passives" "BoomingBlade_Movement_Passive;BoomingBlade_MovementSpell_Passive"
// data "TooltipSave" ""
// data "StatusPropertyFlags" ""

// new entry "BOOMING_BLADE_5"
// type "StatusData"
// data "StatusType" "BOOST"
// using "BOOMING_BLADE"
// data "DescriptionParams" "DealDamage(2d8, Thunder)"
// data "Passives" "BoomingBlade_5_Movement_Passive;BoomingBlade_5_MovementSpell_Passive;"

// new entry "BOOMING_BLADE_11"
// type "StatusData"
// data "StatusType" "BOOST"
// using "BOOMING_BLADE"
// data "DescriptionParams" "DealDamage(3d8, Thunder)"
// data "Passives" "BoomingBlade_11_Movement_Passive;BoomingBlade_11_MovementSpell_Passive;"

// ==================================== Custom level 20 curve

new entry "GOON_BOOMING_BLADE_17"
type "StatusData"
data "StatusType" "BOOST"
using "BOOMING_BLADE"
data "DescriptionParams" "DealDamage(4d8, Thunder)"
data "Passives" "Goon_BoomingBlade_17_Movement_Passive;Goon_BoomingBlade_17_MovementSpell_Passive"

new entry "Goon_BoomingBlade_17_Movement_Passive"
type "PassiveData"
using "BoomingBlade_Movement_Passive"
// %%% Empty
data "DisplayName" "ha57461c0gfb33g47bagb2f0g2b8064a7e509;1"
data "StatsFunctors" "ApplyStatus(SELF, BOOMING_BLADE_11_DAMAGE,100,0);ApplyStatus(SELF, BOOMING_BLADE_DAMAGE_IMMUNITY, 100, 0)"

new entry "Goon_BoomingBlade_17_MovementSpell_Passive"
type "PassiveData"
using "BoomingBlade_MovementSpell_Passive"
// %%% Empty
data "DisplayName" "h6643abfegd843g437dg947dg8151b772282d;1"
data "StatsFunctors" "ApplyStatus(SELF, BOOMING_BLADE_11_DAMAGE,100,0);ApplyStatus(SELF, BOOMING_BLADE_DAMAGE_IMMUNITY, 100, 0)"

new entry "GOON_BOOMING_BLADE_17_DAMAGE"
type "StatusData"
data "StatusType" "BOOST"
using "BOOMING_BLADE_DAMAGE"
data "DescriptionParams" "DealDamage(4d8, Thunder)"
data "OnApplyFunctors" "DealDamage(4d8, Thunder,Magical,,0,,true,true);RemoveStatus(SELF, GOON_BOOMING_BLADE_17)"

// ==================================== Blasting Blade ???

// new entry "Target_BoomingBladeEx"
// type "SpellData"
// data "SpellType" "Target"
// using "Target_BoomingBlade"
// data "SpellSuccess" "IF(not SavingThrow(Ability.Strength, ManeuverSaveDC())):Force(4.5);ApplyStatus(BOOMING_BLADE,100,1);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType); ExecuteWeaponFunctors(MainHand)"
// Blasting Blade
// data "DisplayName" "h5fb228eag8f75g49eagab20g740b2b11433a;2"
// Strike with your weapon, afflicting your foe with a resonance that hurts them for [1] when they move and possibly pushing them back [2].
// data "Description" "hc9c9f16egfcf1g408cg9abbg8398527b7331;4"
// data "DescriptionParams" "Distance(4.5);DealDamage(1d8, Thunder)"
// data "ExtraDescription" ""
// data "TooltipAttackSave" "MeleeWeaponAttack;Strength"
// data "TargetSound" "Spell_Impact_Sorcerer_BoomingBlade"