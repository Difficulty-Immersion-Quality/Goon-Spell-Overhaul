// ==================================== Shadow Blade ====================================
// Bug Fix: Shadow Blade Ring no longer needlessly breaks concentration when unequipped. 
// Changes: It's a magical weapon, the summoner has innate proficiency with it, it uses the summoner's spell casting ability for attacks. Lasts until long rest. Damage starts at 1d6 and scales to 5d6 with upcasting to level 9 spell slots. Concentration requirement removed.
// Changes: The weapon itself is now a proper magical scimitar, with all that entails. 
// Changes: The wielder has innate proficiency with the weapon.
// Changes: The wielders spellcasting ability modifier is now used for attack rolls.
// Changes: Damage starts at 1d6 Psychic damage without being upcast, and scales to 5d6 Psychic damage with upcasting using a level 9 spell slot.
// TODO: Shadow Blade's Advantage against obscured targets is only applied to attacks with the weapon itself. (The fix for this will be enabled once I've completed a rather verbose project.)

// ==================================== Shadow Blade - Statuses (Vanilla)

new entry "MAG_SHADOW_BLADE_RING_TECHNICAL"
type "StatusData"
data "StatusType" "BOOST"
using "MAG_SHADOW_BLADE_RING_TECHNICAL"
// %%% Empty
// data "DisplayName" "hedcf34f1g4c08g4626ga6a6g6cf4e7f728b8;1"
// data "StackId" "MAG_SHADOW_BLADE_RING_TECHNICAL"
// data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator;IgnoreResting;ApplyToDead"
// data "OnRemoveFunctors" "IF(HasStatus('MAG_SHADOW_BLADE_OWNER')):BreakConcentration()"
data "OnRemoveFunctors" ""

// new entry "SHADOWBLADE_TECHNICAL_1"
// type "StatusData"
// data "StatusType" "BOOST"
// Upcast Bonus
// data "DisplayName" "he7d1a8afg07c2g4a09ga26ag839fa4f947e1;1"
// Damage increased by [1].
// data "Description" "h8f4a77bcg3575g4c88g909ag47bee584e88d;1"
// data "DescriptionParams" "DealDamage(1d8,Psychic)"
// data "Boosts" "WeaponDamageDieOverride(3d8);"
// data "RemoveConditions" "not HasStatus('MAG_SHADOW_BLADE_OWNER', GetOwner(context.Source))"
// data "RemoveEvents" "OnStatusRemoved"
// data "StatusPropertyFlags" "DisableCombatlog;DisableOverhead;DisablePortraitIndicator"

// new entry "SHADOWBLADE_TECHNICAL_2"
// type "StatusData"
// data "StatusType" "BOOST"
// Upcast Bonus
// data "DisplayName" "hb0a28e95g1dd9g456agbf35gff52219c90cb;2"
// Damage increased by [1].
// data "Description" "h6f088260gb3a7g4d32g89a7g572c1daf010f;1"
// data "DescriptionParams" "DealDamage(2d8,Psychic)"
// data "Boosts" "WeaponDamageDieOverride(4d8);"
// data "RemoveConditions" "not HasStatus('MAG_SHADOW_BLADE_OWNER', GetOwner(context.Source))"
// data "RemoveEvents" "OnStatusRemoved"
// data "StatusPropertyFlags" "DisableOverhead;DisablePortraitIndicator;DisableCombatlog"

new entry "MAG_SHADOW_BLADE_OWNER"
type "StatusData"
data "StatusType" "BOOST"
using "MAG_SHADOW_BLADE_OWNER"
// %%% Empty
// data "DisplayName" "h7a973781g041bg46aag9554g83de88b20158;1"
// data "StackId" "MAG_SHADOW_BLADE_OWNER"
// data "Boosts" ""
// data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator;ApplyToDead"

new entry "SHADOW_BLADE"
type "StatusData"
data "StatusType" "EFFECT"
using "SHADOW_BLADE"
// Shadow Blade
// data "DisplayName" "h38597068g4807g4de5g8f4bg2f09324e7e59;2"
// The wielder has &lt;LSTag Tooltip="Advantage"&gt;Advantage&lt;/LSTag&gt; on &lt;LSTag Tooltip="AttackRoll"&gt;Attack Rolls&lt;/LSTag&gt; against Lightly or Heavily Obscured targets while using this blade.
// data "Description" "ha682958cg2180g48cag90f1gc17402e0e2af;3"
// data "Icon" "PassiveFeature_Generic_Darkness"
// data "SoundLoop" "MAG_Status_ShadowBlade"
// data "SoundStop" "MAG_Status_ShadowBlade_Stop"
// data "Boosts" "Attribute(InventoryBound)"
data "Boosts" "Attribute(InventoryBound);IntrinsicSummonerProficiency();WeaponAttackRollAbilityOverride(SpellCastingAbility)"
// data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
// data "StatusEffect" "4c40f7ab-8513-49da-ae71-b7faae9079ca"
data "IsUnique" "1"

// ==================================== Shadow Blade - Statuses (Custom)

new entry "GOON_SHADOW_BLADE_3"
type "StatusData"
data "StatusType" "BOOST"
using "SHADOW_BLADE"
// data "Boosts" "Attribute(InventoryBound);WeaponDamageDieOverride(3d8)"
data "Boosts" "Attribute(InventoryBound);IntrinsicSummonerProficiency();WeaponDamageDieOverride(2d6);WeaponAttackRollAbilityOverride(SpellCastingAbility)"

new entry "GOON_SHADOW_BLADE_4"
type "StatusData"
data "StatusType" "BOOST"
using "SHADOW_BLADE"
// data "Boosts" "Attribute(InventoryBound);WeaponDamageDieOverride(3d8)"
data "Boosts" "Attribute(InventoryBound);IntrinsicSummonerProficiency();WeaponDamageDieOverride(2d6);WeaponAttackRollAbilityOverride(SpellCastingAbility)"

new entry "GOON_SHADOW_BLADE_5"
type "StatusData"
data "StatusType" "BOOST"
using "SHADOW_BLADE"
// data "Boosts" "Attribute(InventoryBound);WeaponDamageDieOverride(4d8)"
data "Boosts" "Attribute(InventoryBound);IntrinsicSummonerProficiency();WeaponDamageDieOverride(3d6);WeaponAttackRollAbilityOverride(SpellCastingAbility)"

new entry "GOON_SHADOW_BLADE_6"
type "StatusData"
data "StatusType" "BOOST"
using "SHADOW_BLADE"
// data "Boosts" "Attribute(InventoryBound);WeaponDamageDieOverride(4d8)"
data "Boosts" "Attribute(InventoryBound);IntrinsicSummonerProficiency();WeaponDamageDieOverride(3d6);WeaponAttackRollAbilityOverride(SpellCastingAbility)"

new entry "GOON_SHADOW_BLADE_7"
type "StatusData"
data "StatusType" "BOOST"
using "SHADOW_BLADE"
// data "Boosts" "Attribute(InventoryBound);WeaponDamageDieOverride(5d8)"
data "Boosts" "Attribute(InventoryBound);IntrinsicSummonerProficiency();WeaponDamageDieOverride(4d6);WeaponAttackRollAbilityOverride(SpellCastingAbility)"

new entry "GOON_SHADOW_BLADE_8"
type "StatusData"
data "StatusType" "BOOST"
using "SHADOW_BLADE"
// data "Boosts" "Attribute(InventoryBound);WeaponDamageDieOverride(5d8)"
data "Boosts" "Attribute(InventoryBound);IntrinsicSummonerProficiency();WeaponDamageDieOverride(4d6);WeaponAttackRollAbilityOverride(SpellCastingAbility)"

new entry "GOON_SHADOW_BLADE_9"
type "StatusData"
data "StatusType" "BOOST"
using "SHADOW_BLADE"
data "Boosts" "Attribute(InventoryBound);IntrinsicSummonerProficiency();WeaponDamageDieOverride(5d6);WeaponAttackRollAbilityOverride(SpellCastingAbility)"

// ==================================== Shadow Blade - Weapon

new entry "WPN_ShadowBlade"
type "Weapon"
// using "WPN_Shortsword_1"
using "WPN_ShadowBlade"
// data "RootTemplate" "66d6cbd5-c231-4fc4-a3b7-80f781b579f7"
// data "Damage Type" "Psychic"
// data "Damage" "2d8"
data "Damage" "1d6"
// data "ValueUUID" "86e7e503-a225-4b48-819e-2e24de1f904a"
// data "DefaultBoosts" "WeaponProperty(Magical);CannotBeDisarmed();HiddenDuringCinematic();"
data "DefaultBoosts" "WeaponProperty(Magical);CannotBeDisarmed()"
// data "PersonalStatusImmunities" "WEAPON_COATED_WITH_POISON;POISON_BASIC;POISON_SERPENT_VENOM;POISON_WYVERN;POISON_WYVERN_DIPPED;POISON_PURPLE_WORM;DIPPED_FIRE;DIPPED_POISON;DIPPED_WATER"
// data "PassivesOnEquip" "ShadowBlade_Passive"
// data "Unique" "1"
// data "Weapon Group" "SimpleMeleeWeapon"
// data "Weapon Properties" "Finesse;Light;Melee;Dippable"
// data "Proficiency Group" "Shortswords;SimpleWeapons"

// ==================================== Shadow Blade - Passive

// new entry "ShadowBlade_Passive"
// type "PassiveData"
// using "ShadowBlade_Passive"
// Shadow Blade
// data "DisplayName" "h0160e9efg8974g43d6gb3fcg8d4e9d200a3c;4"
// You have &lt;LSTag Tooltip="Advantage"&gt;Advantage&lt;/LSTag&gt; on &lt;LSTag Tooltip="AttackRoll"&gt;Attack Rolls&lt;/LSTag&gt; against Lightly or Heavily Obscured targets when using this blade.
// data "Description" "ha672fd65g0fe4g4596g9529gce372c013ca1;6"
// Your &lt;LSTag Tooltip="AttackRoll"&gt;Attack Rolls&lt;/LSTag&gt; with this blade have &lt;LSTag Tooltip="Advantage"&gt;Advantage&lt;/LSTag&gt; against Lightly or Heavily Obscured targets.
// data "Description" "h1eec2cd1gc17dg48cdg8982g879f95483b05;1"
// data "BoostConditions" "AttackedWithPassiveSourceWeapon()"
// data "Boosts" "IF(not HasObscuredState(ObscuredState.Clear) and IsMeleeAttack() and IsWeaponAttack()):Advantage(AttackRoll);"
// data "Boosts" "IF((IsAttackType(AttackType.MeleeWeaponAttack) or IsAttackType(AttackType.MeleeOffHandWeaponAttack)) and not HasObscuredState(ObscuredState.Clear)):Advantage(AttackRoll)"

// ==================================== Shadow Blade - Spells

new entry "Shout_ShadowBlade"
type "SpellData"
data "SpellType" "Shout"
// using "Shout_FlameBlade"
using "Shout_ShadowBlade"
// data "Level" "2"
// data "SpellSchool" "Illusion"
// data "Cooldown" "OncePerShortRestPerItem"
// data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,SHADOW_BLADE);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1);"
// data "TargetConditions" "Self()"
// data "Icon" "Spell_Illusion_ShadowBlade"
// Shadow Blade
// data "DisplayName" "h245d543eg02dfg45f5g910age84e27663e89;2"
// Weave a shadowy shortsword in your hand that deals [1]. 
// data "Description" "h3ce51988gc9efg482ag9b9egdabe769a9482;3"
// data "DescriptionParams" " DealDamage(2d8,Psychic);"
data "DescriptionParams" "DealDamage(1d6,Psychic)"
// When you use the sword to attack a target that is in dim light or darkness, you make the &lt;LSTag Tooltip="AttackRoll"&gt;Attack Roll&lt;/LSTag&gt; with &lt;LSTag Tooltip="Advantage"&gt;Advantage&lt;/LSTag&gt;.&lt;br&gt;&lt;br&gt;The shadow blade can be unequipped and equipped again, but must remain on the spellcaster's person.
// data "ExtraDescription" "h7733bf81g92a2g4f0bgbc0cgf7fd1fe30eea;3"
// data "TooltipUpcastDescription" ""
// data "TooltipUpcastDescriptionParams" ""
// data "PrepareSound" "Action_Prepare_Item_ShadowBlade"
// data "PrepareLoopSound" "Action_Loop_Item_ShadowBlade"
// data "CastSound" "Action_Cast_Item_ShadowBlade"
// data "TargetSound" "Action_Impact_Item_ShadowBlade"
// data "VocalComponentSound" "Vocal_Component_EnchantWeapon"
// data "CastTextEvent" "Cast"
// data "UseCosts" "BonusActionPoint:1"
// data "SpellAnimation" "3ff87abf-1ea1-4c32-aadf-c822d74c7dc0,,;,,;35b644cf-5c13-4407-9dc1-23bf4309216e,,;823e3ddf-c670-41ef-b7b4-9f4a4e38300b,,;d8925ce4-d6d9-400c-92f5-ad772ef7f178,,;,,;eadedcce-d01b-4fbb-a1ae-d218f13aa5d6,,;,,;,,"
// data "VerbalIntent" "Damage"
// data "SpellFlags" "IsSpell;HasVerbalComponent;HasSomaticComponent"
// data "SpellAnimationIntentType" "Aggressive"
// data "PrepareEffect" "3998daf3-8dd5-4b10-b33a-5ab51bb97860"
// data "CastEffect" "514ecdc7-87b3-43f8-bd8a-69fb3b46f8da"
// data "DamageType" ""

new entry "Shout_ShadowBlade_Class"
type "SpellData"
data "SpellType" "Shout"
// using "Shout_ShadowBlade"
using "Shout_ShadowBlade_Class"
// data "Cooldown" ""
// data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1);"
data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1)"
// When you use the sword to attack a target that is in dim light or darkness, you make the &lt;LSTag Tooltip="AttackRoll"&gt;Attack Roll&lt;/LSTag&gt; with &lt;LSTag Tooltip="Advantage"&gt;Advantage&lt;/LSTag&gt;.&lt;br&gt;&lt;br&gt;The shadow blade can be unequipped and equipped again, but must remain on the spellcaster's person.
// data "ExtraDescription" "h7733bf81g92a2g4f0bgbc0cgf7fd1fe30eea;3"
// When you use the sword to attack a target that is in dim light or darkness, you make the &lt;LSTag Tooltip="AttackRoll"&gt;Attack Roll&lt;/LSTag&gt; with &lt;LSTag Tooltip="Advantage"&gt;Advantage&lt;/LSTag&gt;.&lt;br&gt;&lt;br&gt;The shadow blade can be unequipped and equipped again, but must remain on the spellcaster's person.
data "ExtraDescription" "h7733bf81g92a2g4f0bgbc0cgf7fd1fe30eea;3"
// Casting this spell using a Level 3 or 4 spell slot will increase the bonus by [1], and casting using a Level 5 or 6 spell slot will increase it by [2].
// data "TooltipUpcastDescription" "feb2f892-b684-442c-b22d-88a3d411a1a2"
// Deals an additional [1] per [2] levels.
data "TooltipUpcastDescription" "7bbb79fa-02c7-4f45-a115-1d8e11b96ea0"
// data "TooltipUpcastDescriptionParams" "DealDamage(1d8,Psychic);DealDamage(2d8,Psychic)"
data "TooltipUpcastDescriptionParams" "DealDamage(1d6,Psychic);2"
// data "UseCosts" "BonusActionPoint:1;SpellSlotsGroup:1:1:2;"
// data "SpellFlags" "IsSpell;HasVerbalComponent;HasSomaticComponent"
data "SpellFlags" "IsSpell;HasVerbalComponent;HasSomaticComponent"

new entry "Shout_ShadowBlade_Class_3"
type "SpellData"
data "SpellType" "Shout"
// using "Shout_ShadowBlade_Class"
using "Shout_ShadowBlade_Class_3"
// data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,SHADOWBLADE_TECHNICAL_1);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1);"
data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,GOON_SHADOW_BLADE_3);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1)"
// data "DescriptionParams" " DealDamage(3d8,Psychic);"
data "DescriptionParams" "DealDamage(2d6,Psychic)"
// data "UseCosts" "BonusActionPoint:1;SpellSlotsGroup:1:1:3;"
// data "RootSpellID" "Shout_ShadowBlade_Class"
// data "PowerLevel" "3"

new entry "Shout_ShadowBlade_Class_4"
type "SpellData"
data "SpellType" "Shout"
// using "Shout_ShadowBlade_Class"
using "Shout_ShadowBlade_Class_4"
// data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,SHADOWBLADE_TECHNICAL_1);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1);"
data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,GOON_SHADOW_BLADE_4);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1)"
// data "DescriptionParams" " DealDamage(3d8,Psychic);"
data "DescriptionParams" "DealDamage(2d6,Psychic)"
// data "UseCosts" "BonusActionPoint:1;SpellSlotsGroup:1:1:4;"
// data "RootSpellID" "Shout_ShadowBlade_Class"
// data "PowerLevel" "4"

new entry "Shout_ShadowBlade_Class_5"
type "SpellData"
data "SpellType" "Shout"
// using "Shout_ShadowBlade_Class"
using "Shout_ShadowBlade_Class_5"
// data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,SHADOWBLADE_TECHNICAL_2);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1);"
data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,GOON_SHADOW_BLADE_5);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1)"
// data "DescriptionParams" " DealDamage(4d8,Psychic);"
data "DescriptionParams" "DealDamage(3d6,Psychic)"
// data "UseCosts" "BonusActionPoint:1;SpellSlotsGroup:1:1:5;"
// data "RootSpellID" "Shout_ShadowBlade_Class"
// data "PowerLevel" "5"

new entry "Shout_ShadowBlade_Class_6"
type "SpellData"
data "SpellType" "Shout"
// using "Shout_ShadowBlade_Class"
using "Shout_ShadowBlade_Class_6"
// data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,SHADOWBLADE_TECHNICAL_2);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1);"
data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,GOON_SHADOW_BLADE_6);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1)"
// data "DescriptionParams" " DealDamage(4d8,Psychic);"
data "DescriptionParams" "DealDamage(3d6,Psychic)"
// data "UseCosts" "BonusActionPoint:1;SpellSlotsGroup:1:1:6;"
// data "RootSpellID" "Shout_ShadowBlade_Class"
// data "PowerLevel" "6"

new entry "Shout_ShadowBlade_Class_7"
type "SpellData"
data "SpellType" "Shout"
using "Shout_ShadowBlade_Class"
data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,GOON_SHADOW_BLADE_7);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1)"
data "DescriptionParams" "DealDamage(4d6,Psychic)"
data "UseCosts" "BonusActionPoint:1;SpellSlotsGroup:1:1:7"
data "RootSpellID" "Shout_ShadowBlade_Class"
data "PowerLevel" "7"

new entry "Shout_ShadowBlade_Class_8"
type "SpellData"
data "SpellType" "Shout"
using "Shout_ShadowBlade_Class"
data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,GOON_SHADOW_BLADE_8);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1)"
data "DescriptionParams" "DealDamage(4d6,Psychic)"
data "UseCosts" "BonusActionPoint:1;SpellSlotsGroup:1:1:8"
data "RootSpellID" "Shout_ShadowBlade_Class"
data "PowerLevel" "8"

new entry "Shout_ShadowBlade_Class_8"
type "SpellData"
data "SpellType" "Shout"
using "Shout_ShadowBlade_Class"
data "SpellProperties" "AI_IGNORE:SummonInInventory(66d6cbd5-c231-4fc4-a3b7-80f781b579f7,-1,1,true,true,true,,,'ShadowBlade',SHADOW_BLADE,GOON_SHADOW_BLADE_9);ApplyStatus(SELF, MAG_SHADOW_BLADE_OWNER, 100, -1)"
data "DescriptionParams" "DealDamage(5d6,Psychic)"
data "UseCosts" "BonusActionPoint:1;SpellSlotsGroup:1:1:9"
data "RootSpellID" "Shout_ShadowBlade_Class"
data "PowerLevel" "9"
