// ==================================== Counterspell ====================================
// Bug Fix: Abjuration Wizard's Arcane Ward is fed the appropriate amount of charges based on spell level.
// Bug Fix: Interrupts can be used while under the effects of more non-hostile and non-spellcasting restricted Polymorphs.
// Changes: Can no longer interrupt spells while Blinded.
// Changes: Can now be used by Invisible player characters.
// Changes: If the caster is Invisible or Hidden, spells with the "Stealth" flag cannot be interrupted.

// new entry "Target_Counterspell"
// type "SpellData"
// data "SpellType" "Target"
// data "Level" "3"
// data "SpellSchool" "Abjuration"
// data "TargetRadius" "18"
// data "TargetConditions" "Character()"
// data "Icon" "Spell_Abjuration_Counterspell"
// Counterspell
// data "DisplayName" "hc438efbcgedbag41e9gb01egade042468a55;2"
// Try to stop a spell being cast. 
// data "Description" "h4626b545gb292g41e2gac8dgedf05aa09b61;7"
// If it is higher level than the &lt;LSTag Tooltip="SpellSlot"&gt;spell slot&lt;/LSTag&gt; you used to Counterspell, you must make a &lt;LSTag Tooltip="AbilityCheck"&gt;check&lt;/LSTag&gt; using your spellcasting ability to prevent it. The check's difficulty is equal to [1] plus the level of the spell you are trying to counter.
// data "ExtraDescription" "hd9138ff3gff83g44b4gbff8gdd07c4696f4c;2"
// data "ExtraDescriptionParams" "10"
// data "CastTextEvent" "Cast"
// data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:3"
// data "SpellAnimation" "554a18f7-952e-494a-b301-7702a85d4bc9,,;,,;1fd48304-2ba1-4dcb-8efa-4550517305ed,,;2afb250c-e441-4573-a75e-e1fdad1c6064,,;22dfbbf4-f417-4c84-b39e-2039315961e6,,;,,;5bfbe9f9-4fc3-4f26-b112-43d404db6a89,,;,,;,,"
// data "VerbalIntent" "Control"
// data "SpellFlags" "IsSpell"
// data "MemoryCost" "1"
// data "InterruptPrototype" "Interrupt_Counterspell"
// data "SteerSpeedMultipler" "10.5"

new entry "Interrupt_Counterspell"
type "InterruptData"
using "Interrupt_Counterspell"
// Counterspell
// data "DisplayName" "h48686e1eg13fdg4ee5g8b51gb3eb602d599d;2"
// Stop a spell from being cast. If it is higher level than the &lt;LSTag Tooltip="SpellSlot"&gt;spell slot&lt;/LSTag&gt; used to Counterspell, you must roll to prevent it.
// data "Description" "haa58fc9dge729g49ccga2bdgb382c61b3890;5"
// data "Icon" "PassiveFeature_Counterspell"
// data "InterruptContext" "OnSpellCast"
// data "InterruptContextScope" "Nearby"
// data "Container" "YesNoDecision"
// data "Conditions" "not HasSpellCastBlocked(context.Observer) and IsAbleToReact(context.Observer) and not Self(context.Source, context.Observer) and Enemy(context.Source, context.Observer) and IsSpell() and not Uninterruptible() and not HasStringInSpellRoll('WeaponAttack') and not AnyEntityIsItem() and not SpellId('Shout_END_Gale_ActivateNethereseOrb') and CounterspellCheck(context.Observer, context.Source)"
data "Conditions" "(Player(context.Observer) or not HasStatus('SG_Invisible',context.Observer)) and not HasSpellCastBlocked(context.Observer) and IsAbleToReact(context.Observer) and not Self(context.Source, context.Observer) and Enemy(context.Source, context.Observer) and IsSpell() and not Uninterruptible() and not HasStringInSpellRoll('WeaponAttack') and not AnyEntityIsItem() and not SpellId('Shout_END_Gale_ActivateNethereseOrb') and CounterspellCheck(context.Observer, context.Source) and (not HasSpellFlag(SpellFlags.Stealth, context.Source) and not IsSneakingOrInvisible())"
// data "Roll" "TryCounterspellHigherLevel(3)"
// data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Target_Counterspell_Success,true,true,true)"
// data "Failure" "UseSpell(OBSERVER_SOURCE,Target_Counterspell_Failure,true,true,true)"
// data "Cost" "ReactionActionPoint:1;SpellSlotsGroup:1:1:3"
// data "InterruptDefaultValue" "Ask;Enabled"
// data "EnableCondition" "not HasStatus('SG_Polymorph') or HasAnyStatus({'SG_Disguise','WILDSHAPE_STARRY_ARCHER_PLAYER','WILDSHAPE_STARRY_CHALICE_PLAYER','WILDSHAPE_STARRY_DRAGON_PLAYER'});"
data "EnableCondition" "(not HasStatus('SG_Polymorph') or Goon_IsUnrestrictedPolymorphStatus()) and not HasStatus('SG_Blinded')"
// data "EnableContext" "OnStatusApplied;OnStatusRemoved"
data "InterruptFlags" "InterruptWhileInvisible"

new entry "Target_Counterspell_Success"
type "SpellData"
data "SpellType" "Target"
// using "Target_Counterspell"
using "Target_Counterspell_Success"
// Nullify another creature's spell as a reaction. The spell must be 3rd Level or lower. If it is higher, you must succeed a &lt;LSTag Tooltip="AbilityCheck"&gt;Check&lt;/LSTag&gt; to nullify it, the difficulty of which is based on  the spell's Level.
// data "Description" "h777c571cge100g48e8g8765gdce1ecec328d;2"
// data "CastSound" "Spell_Cast_Control_CounterSpell_L1to3"
// data "TargetSound" "Spell_Impact_Control_CounterSpell_L1to3"
// data "CastTextEvent" "Cast"
// data "SpellAnimation" ",,;,,;b04ce010-286c-4eaf-9b7e-dc42aa6c0b8f,,;,,;,,;,,;,,;,,;,,"
data "VocalComponentSound" "Vocal_Component_Silence"
// data "CastEffect" "2c5a0742-e685-41dc-af87-477ce2d7779b"
// data "TargetEffect" "e1c681ba-b303-4c9e-ab60-8984efac755e"
// data "BeamEffect" "79f74c1f-dec0-4847-a206-f9289407afe0"
// data "InterruptPrototype" ""

// new entry "Target_Counterspell_Failure"
// type "SpellData"
// data "SpellType" "Target"
// using "Target_Counterspell_Success"
// data "TargetRadius" "18"
// Failed Counterspell
// data "DisplayName" "h54fa64b7g22ebg48abg86f5ga33a483739d2;3"
// data "CastSound" ""
// data "CastTextEvent" "Cast"
// data "SpellAnimation" ",,;,,;10f0aecc-d23f-4922-b2ca-04a1d304054d,,;,,;,,;,,;,,;,,;,,"
// data "SpellFlags" "IsSpell"
// data "TargetEffect" ""
// data "BeamEffect" ""

// ==================================== Counterspell: Spell Mastery (Expansion)

// new entry "Interrupt_Counterspell_SignatureSpells"
// type "InterruptData"
// using "Interrupt_Counterspell"
// Counterspell: Spell Mastery
// data "DisplayName" "hcfcbe207gb8eeg4c66ga111g6c625ca26e52;1"
// data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Target_Counterspell_Success_SpellMastery,true,true,true)"
// data "Failure" "UseSpell(OBSERVER_SOURCE,Target_Counterspell_Failure_SpellMastery,true,true,true)"
// data "Cost" "ReactionActionPoint:1;SignatureSpells_Freecast:1"

// ==================================== Upcasting - Counterspell - 4

// new entry "Target_Counterspell_4"
// type "SpellData"
// data "SpellType" "Target"
// using "Target_Counterspell"
// data "TargetSound" ""
// data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:4"
// data "SpellFlags" "IsSpell"
// data "RootSpellID" "Target_Counterspell"
// data "PowerLevel" "4"
// data "InterruptPrototype" "Interrupt_Counterspell_4"

new entry "Interrupt_Counterspell_4"
type "InterruptData"
// using "Interrupt_Counterspell"
using "Interrupt_Counterspell_4"
// data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Target_Counterspell_Success,true,true,true)"
data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Success_4,true,true,true)"
// data "Failure" "UseSpell(OBSERVER_SOURCE,Target_Counterspell_Failure,true,true,true)"
data "Failure" "UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Failure_4,true,true,true)"

new entry "Goon_Target_Counterspell_Success_4"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Success"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:4"
data "PowerLevel" "4"

new entry "Goon_Target_Counterspell_Failure_4"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Failure"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:4"
data "PowerLevel" "4"

// ==================================== Upcasting - Counterspell - 5

// new entry "Target_Counterspell_5"
// type "SpellData"
// data "SpellType" "Target"
// using "Target_Counterspell"
// data "TargetSound" ""
// data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:5"
// data "SpellFlags" "IsSpell"
// data "RootSpellID" "Target_Counterspell"
// data "PowerLevel" "5"
// data "InterruptPrototype" "Interrupt_Counterspell_5"

new entry "Interrupt_Counterspell_5"
type "InterruptData"
// using "Interrupt_Counterspell"
using "Interrupt_Counterspell_5"
// data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Target_Counterspell_Success,true,true,true)"
data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Success_5,true,true,true)"
// data "Failure" "UseSpell(OBSERVER_SOURCE,Target_Counterspell_Failure,true,true,true)"
data "Failure" "UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Failure_5,true,true,true)"

new entry "Goon_Target_Counterspell_Success_5"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Success"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:5"
data "PowerLevel" "5"

new entry "Goon_Target_Counterspell_Failure_5"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Failure"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:5"
data "PowerLevel" "5"

// ==================================== Upcasting - Counterspell - 6

// new entry "Target_Counterspell_6"
// type "SpellData"
// data "SpellType" "Target"
// using "Target_Counterspell"
// data "TargetSound" ""
// data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:6"
// data "SpellFlags" "IsSpell"
// data "RootSpellID" "Target_Counterspell"
// data "PowerLevel" "6"
// data "InterruptPrototype" "Interrupt_Counterspell_6"

new entry "Interrupt_Counterspell_6"
type "InterruptData"
// using "Interrupt_Counterspell"
using "Interrupt_Counterspell_6"
// data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Target_Counterspell_Success,true,true,true)"
data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Success_6,true,true,true)"
// data "Failure" "UseSpell(OBSERVER_SOURCE,Target_Counterspell_Failure,true,true,true)"
data "Failure" "UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Failure_6,true,true,true)"

new entry "Goon_Target_Counterspell_Success_6"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Success"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:6"
data "PowerLevel" "6"

new entry "Goon_Target_Counterspell_Failure_6"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Failure"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:6"
data "PowerLevel" "6"

// ==================================== Upcasting - Counterspell - 7

new entry "Target_Counterspell_7"
type "SpellData"
data "SpellType" "Target"
// using "Target_Counterspell"
using "Target_Counterspell_7"
data "TargetSound" ""
// data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:7"
// data "RootSpellID" "Target_Counterspell"
// data "PowerLevel" "7"
// data "InterruptPrototype" "Interrupt_Counterspell_7"

new entry "Interrupt_Counterspell_7"
type "InterruptData"
// using "Interrupt_Counterspell"
using "Interrupt_Counterspell_7"
// data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Target_Counterspell_Success,true,true,true)"
data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Success_7,true,true,true)"
// data "Failure" "UseSpell(OBSERVER_SOURCE,Target_Counterspell_Failure,true,true,true)"
data "Failure" "UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Failure_7,true,true,true)"

new entry "Goon_Target_Counterspell_Success_7"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Success"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:7"
data "PowerLevel" "7"

new entry "Goon_Target_Counterspell_Failure_7"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Failure"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:7"
data "PowerLevel" "7"

// ==================================== Upcasting - Counterspell - 8

new entry "Target_Counterspell_8"
type "SpellData"
data "SpellType" "Target"
// using "Target_Counterspell"
using "Target_Counterspell_8"
data "TargetSound" ""
// data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:8"
// data "RootSpellID" "Target_Counterspell"
// data "PowerLevel" "8"
// data "InterruptPrototype" "Interrupt_Counterspell_8"

new entry "Interrupt_Counterspell_8"
type "InterruptData"
// using "Interrupt_Counterspell"
using "Interrupt_Counterspell_8"
// data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Target_Counterspell_Success,true,true,true)"
data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Success_8,true,true,true)"
// data "Failure" "UseSpell(OBSERVER_SOURCE,Target_Counterspell_Failure,true,true,true)"
data "Failure" "UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Failure_8,true,true,true)"

new entry "Goon_Target_Counterspell_Success_8"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Success"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:8"
data "PowerLevel" "8"

new entry "Goon_Target_Counterspell_Failure_8"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Failure"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:8"
data "PowerLevel" "8"

// ==================================== Upcasting - Counterspell - 9

new entry "Target_Counterspell_9"
type "SpellData"
data "SpellType" "Target"
// using "Target_Counterspell"
using "Target_Counterspell_9"
data "TargetSound" ""
// data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:9"
// data "RootSpellID" "Target_Counterspell"
// data "PowerLevel" "9"
// data "InterruptPrototype" "Interrupt_Counterspell_9"

new entry "Interrupt_Counterspell_9"
type "InterruptData"
// using "Interrupt_Counterspell"
using "Interrupt_Counterspell_9"
// data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Target_Counterspell_Success,true,true,true)"
data "Success" "Counterspell();UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Success_9,true,true,true)"
// data "Failure" "UseSpell(OBSERVER_SOURCE,Target_Counterspell_Failure,true,true,true)"
data "Failure" "UseSpell(OBSERVER_SOURCE,Goon_Target_Counterspell_Failure_9,true,true,true)"

new entry "Goon_Target_Counterspell_Success_9"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Success"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:9"
data "PowerLevel" "9"

new entry "Goon_Target_Counterspell_Failure_9"
type "SpellData"
data "SpellType" "Target"
using "Target_Counterspell_Failure"
data "UseCosts" "ReactionActionPoint:1;SpellSlotsGroup:1:1:9"
data "PowerLevel" "9"
